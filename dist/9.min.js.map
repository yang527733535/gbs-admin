{"version":3,"file":"9.min.js","sources":["webpack:///./src/pages/stocks-drama/DramaDetail/roleDetail/AddRoleDetailForm/index.tsx"],"sourcesContent":["import \"@arco-design/web-react/es/Spin/style\";\nimport _Spin from \"@arco-design/web-react/es/Spin\";\nimport \"@arco-design/web-react/es/Space/style\";\nimport _Space from \"@arco-design/web-react/es/Space\";\nimport \"@arco-design/web-react/es/Button/style\";\nimport _Button from \"@arco-design/web-react/es/Button\";\nimport \"@arco-design/web-react/es/Message/style\";\nimport _Message from \"@arco-design/web-react/es/Message\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport \"@arco-design/web-react/es/Upload/style\";\nimport _Upload from \"@arco-design/web-react/es/Upload\";\nimport \"@arco-design/web-react/es/Modal/style\";\nimport _Modal from \"@arco-design/web-react/es/Modal\";\nimport \"@arco-design/web-react/es/Select/style\";\nimport _Select from \"@arco-design/web-react/es/Select\";\nimport \"@arco-design/web-react/es/Input/style\";\nimport _Input from \"@arco-design/web-react/es/Input\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport \"@arco-design/web-react/es/Grid/style\";\nimport _Grid from \"@arco-design/web-react/es/Grid\";\nimport \"@arco-design/web-react/es/Form/style\";\nimport _Form from \"@arco-design/web-react/es/Form\";\nvar _jsxFileName = \"/Users/mrhh/Desktop/gbs-admin/src/pages/stocks-drama/DramaDetail/roleDetail/AddRoleDetailForm/index.tsx\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useRef, useEffect, useState } from 'react';\nimport { reqBindrole } from '../../../../../api/drama.js';\nvar FormItem = _Form.Item;\nvar Row = _Grid.Row;\nvar Col = _Grid.Col;\n\nfunction DramaRoleForm(_ref) {\n  var clickItem = _ref.clickItem,\n      modalType = _ref.modalType,\n      getInitFormData = _ref.getInitFormData,\n      saveEditItem = _ref.saveEditItem,\n      closeModal = _ref.closeModal,\n      role_array = _ref.role_array;\n  // 初始化值为一个对象时\n  var formRef = useRef();\n\n  var onValuesChange = function onValuesChange(changeValue, values) {\n    console.log('onValuesChange: ', changeValue, values);\n  };\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      roleUrl = _useState2[0],\n      setroleUrl = _useState2[1];\n\n  useEffect(function () {\n    if (modalType === 'edit') {\n      setroleUrl(saveEditItem.role_cover);\n      formRef.current.setFieldsValue(saveEditItem);\n    }\n  }, []);\n  return /*#__PURE__*/React.createElement(_Spin, {\n    style: {\n      width: '100%'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(_Form, {\n    ref: formRef,\n    onValuesChange: onValuesChange,\n    scrollToFirstError: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    className: \"grid-demo\",\n    style: {\n      marginBottom: 10\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 46,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    xs: 24,\n    sm: 24,\n    md: 24,\n    lg: 24,\n    xl: 24,\n    xxl: 24,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(FormItem, {\n    label: \"\\u89D2\\u8272\\u540D\\u79F0\",\n    field: \"role_name\",\n    rules: [{\n      required: true,\n      message: '请填写角色名称'\n    }],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(_Input, {\n    placeholder: \"\\u8BF7\\u586B\\u5199\\u89D2\\u8272\\u540D\\u79F0...\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 19\n    }\n  })))), /*#__PURE__*/React.createElement(Col, {\n    xs: 24,\n    sm: 24,\n    md: 24,\n    lg: 24,\n    xl: 24,\n    xxl: 24,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(FormItem, {\n    label: \"\\u89D2\\u8272\\u7B80\\u4ECB\",\n    field: \"role_brief\",\n    rules: [{\n      required: true,\n      message: '请填写角色简介'\n    }],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(_Input, {\n    placeholder: \"\\u8BF7\\u586B\\u5199\\u89D2\\u8272\\u7B80\\u4ECB...\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 19\n    }\n  }))))), /*#__PURE__*/React.createElement(Row, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    xs: 24,\n    sm: 24,\n    md: 24,\n    lg: 24,\n    xl: 24,\n    xxl: 24,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(FormItem, {\n    label: \"\\u662F\\u5426\\u51F6\\u624B\",\n    field: \"is_murderer\",\n    rules: [{\n      required: false,\n      message: '请选择是否凶手'\n    }],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(_Select, {\n    placeholder: \"\\u8BF7\\u9009\\u62E9\\u662F\\u5426\\u51F6\\u624B\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(_Select.Option, {\n    value: \"1\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 21\n    }\n  }, \"\\u662F\"), /*#__PURE__*/React.createElement(_Select.Option, {\n    value: \"0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 21\n    }\n  }, \"\\u5426\"))))), /*#__PURE__*/React.createElement(Col, {\n    xs: 24,\n    sm: 24,\n    md: 24,\n    lg: 24,\n    xl: 24,\n    xxl: 24,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(FormItem, {\n    label: \"\\u89D2\\u8272\\u5907\\u6CE8\",\n    field: \"role_remarks\",\n    rules: [{\n      required: false,\n      message: '请填写角色备注'\n    }],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(_Input, {\n    placeholder: \"\\u8BF7\\u586B\\u5199\\u89D2\\u8272\\u5907\\u6CE8...\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 19\n    }\n  }))))), /*#__PURE__*/React.createElement(Row, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    xs: 24,\n    sm: 24,\n    md: 24,\n    lg: 24,\n    xl: 24,\n    xxl: 24,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(_Form.Item, {\n    rules: [{\n      required: true,\n      message: '请上传角色封面'\n    }],\n    label: \"\\u89D2\\u8272\\u5C01\\u9762\",\n    field: \"role_cover\",\n    triggerPropName: \"fileList\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(_Upload, {\n    limit: 1,\n    renderUploadList: function renderUploadList() {\n      return null;\n    },\n    name: \"role_cover\",\n    customRequest: function customRequest(option) {\n      var onProgress = option.onProgress,\n          onError = option.onError,\n          onSuccess = option.onSuccess,\n          file = option.file;\n      var xhr = new XMLHttpRequest();\n\n      if (xhr.upload) {\n        xhr.upload.onprogress = function (event) {\n          var percent;\n\n          if (event.total > 0) {\n            percent = event.loaded / event.total * 100;\n          }\n\n          onProgress(parseInt(percent, 10), event);\n        };\n      }\n\n      xhr.onerror = function error(e) {\n        onError(e);\n      };\n\n      xhr.onload = function onload() {\n        if (xhr.status < 200 || xhr.status >= 300) {// return onError(xhr.responseText);\n        }\n\n        var data = JSON.parse(xhr.responseText);\n        setroleUrl(data.data.file_url);\n        onSuccess(data);\n      };\n\n      var formData = new FormData();\n      formData.append('up_file', file);\n      formData.append('module', 'drama');\n      xhr.open('post', 'https://gbs.toptian.com/system/upload/image', true);\n      xhr.setRequestHeader('Authorization', localStorage.getItem('token'));\n      xhr.send(formData);\n    },\n    onPreview: function onPreview(file) {\n      _Modal.info({\n        title: 'Preview',\n        content: /*#__PURE__*/React.createElement(\"img\", {\n          src: file.url || URL.createObjectURL(file.originFile),\n          style: {\n            maxWidth: '100%'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 25\n          }\n        })\n      });\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 17\n    }\n  })))), roleUrl === '' ? null : /*#__PURE__*/React.createElement(Row, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(_Form.Item, {\n    label: \"\\u5C01\\u9762\\u56FE\\u7247\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    style: {\n      width: 212,\n      height: 300\n    },\n    src: roleUrl,\n    alt: \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 17\n    }\n  }))), /*#__PURE__*/React.createElement(Row, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    style: {\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(FormItem, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(_Space, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(_Button, {\n    onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var param, newrole_array, param2, data, _param, _data;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!formRef.current) {\n                _context.next = 30;\n                break;\n              }\n\n              _context.prev = 1;\n              _context.next = 4;\n              return formRef.current.validate();\n\n            case 4:\n              param = formRef.current.getFields();\n              param.role_cover = roleUrl;\n              console.log('param', param);\n              newrole_array = role_array.map(function (item) {\n                if (item.role_code === param.role_code) {\n                  return param;\n                } else {\n                  return item;\n                }\n              }); //新增的话 就是push\n              // 不然就是替换\n\n              if (!(modalType === 'add')) {\n                _context.next = 17;\n                break;\n              }\n\n              role_array.push(param);\n              param2 = {};\n              param2.role_array = role_array;\n              param2.gb_code = clickItem.gb_code;\n              _context.next = 15;\n              return reqBindrole(param2);\n\n            case 15:\n              data = _context.sent;\n\n              if (data.code === 200) {\n                _Message.success('添加成功');\n\n                getInitFormData();\n                closeModal();\n              }\n\n            case 17:\n              if (!(modalType === 'edit')) {\n                _context.next = 25;\n                break;\n              }\n\n              _param = {};\n              _param.role_array = newrole_array;\n              _param.gb_code = clickItem.gb_code;\n              _context.next = 23;\n              return reqBindrole(_param);\n\n            case 23:\n              _data = _context.sent;\n\n              if (_data.code === 200) {\n                _Message.success('修改成功');\n\n                getInitFormData();\n                closeModal();\n              }\n\n            case 25:\n              _context.next = 30;\n              break;\n\n            case 27:\n              _context.prev = 27;\n              _context.t0 = _context[\"catch\"](1);\n\n              _Message.error('校验失败，请检查字段！');\n\n            case 30:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 27]]);\n    })),\n    type: \"primary\" // style={{ marginRight: 24 }}\n    ,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 21\n    }\n  }, \"\\u63D0\\u4EA4\"), /*#__PURE__*/React.createElement(_Button, {\n    onClick: function onClick() {\n      formRef.current.resetFields();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 21\n    }\n  }, \"\\u91CD\\u7F6E\")))))))));\n}\n\nexport default DramaRoleForm;"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}